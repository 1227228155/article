# 第十一章 DOM扩展

## 11.1选择符API

```js
var body = document.querySelector('body');
var myDiv = document.querySelector('#myDiv');
var selected = document.querySelector('.selected');
var img = document.body.querySelector('img.button');
var s = document.querySelector('body img');

var ems = document.querySelector('myDiv').querySelectorAll('em');
var selecteds = document.querySelectorAll('.selected');
var strongs = document.querySelectorAll('p strong');
```

```js
var i, len, strong;
for(i = 0, len = strongs.length; i < len; i++) {
	strong = strongs[i]; //or strongs.item(i);
	strong.className = 'act';
}
```

```js
//匹配
function matchesSelector(element, selector) {
	if(element.matchesSelector) {
		return element.matchesSelector(selector);
	} else if(element.msMatchesSelector) {
		return element.msMatchesSelector(selector);
	} else if(element.mozMatchesSelector) {
		return element.mozMatchesSelector(selector);
	} else if(element.webkitMatchesSelector()) {
		return element.webkitMatchesSelector(selector);
	} else {
		throw new Error('not supported');
	}
}
if(matchesSelector(document.body, 'body.class1')) {}
```



## 11.2元素遍历

```js
//元素遍历
//old
var i, len, child = element.firstChild;
while(child != element.lastChild) {
	if(child.nodeType == 1) {
		processChild(child);
	}
	child.child.nextSibling;
}

//ie9+
var i, len, child = element.firstElementChild;
while(child != element.lastElementChild) {

	processChild(child);

	child = child.nextElementSibling;
}
```

## 11.3HTML5

### 11.3.1与类相关的扩充

```js
//ie9+
var s = document.getElementsByClassName();

//ie6+
if(!document.getElementsByClassName) {
	document.getElementsByClassName = function(className, element) {
		var children = (element || document).getElementsByTagName('*');
		var elements = new Array();
		for(var i = 0; i < children.length; i++) {
			var child = children[i];
			var classNames = child.className.split(' ');
			for(var j = 0; j < classNames.length; j++) {
				if(classNames[j] == className) {
					elements.push(child);
					break;
				}
			}
		}
		return elements;
	};
}
```

```js
//<div class="bd user disabled">..</div>

//删除类名
var className = div.className.split(/\s+/);
var pos = -1,
	i, len;
for(i = 0, len = className.length; i < len; i++) {
	if(className[i] == 'user') {
		pos = i;
		break;
	}
}
className.splice(i, 1);
div.className = className.join(" ");

//ie10+
div.classList.remove('disabled');
div.classList.add('current');
div.classList.toggle('user');
//是否包含类名
if(div.classList.contains('bd') && !div.classList.contains('disabled')) {
	//
}
//迭代类名
for(var i = 0, len = div.classList.length; i < len; i++) {
	dosometing(div.classList)[i];
}
```



### 11.3.2焦点管理

```js
//焦点管理
var button = document.getElementById('myBtn');
button.focus();
alert(document.activeElement === button); //true
alert(button.hasFocus()); //true
```

### 11.3.3HTMLdocument的变化

